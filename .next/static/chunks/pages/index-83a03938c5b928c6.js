(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(9828)}])},9828:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var n=a(5893),r=a(7294),i=a(3495),o=a(1526),s=a(8583),l=a(1120),c=a.n(l),u=a(1819);function d(){let[e,t]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),[d,h]=(0,r.useState)(!1),[y,m]=(0,r.useState)(!1),[p,w]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[E,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)({width:window.innerWidth,height:window.innerHeight}),b=(0,r.useRef)(null),x=(0,r.useRef)(null),C=(0,r.useRef)([]),k=(0,r.useRef)(null),D=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=()=>{N({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let S=async t=>{t.preventDefault(),h(!0);try{let t=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0),a=await fetch("/api/generate-story",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entries:t})});if(!a.ok)throw Error("Failed to generate story");let n=await a.json();l(n.story),m(!0),setTimeout(()=>m(!1),5e3)}catch(e){console.error("Error:",e),alert("Failed to generate story. Please try again.")}finally{h(!1)}},P=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});x.current=new MediaRecorder(e),C.current=[],x.current.ondataavailable=e=>{C.current.push(e.data)},x.current.onstop=()=>{let e=new Blob(C.current,{type:"audio/wav"}),t=URL.createObjectURL(e);b.current&&(b.current.src=t),j(!0),f(!1)},x.current.start(),f(!0)}catch(e){console.error("Error accessing microphone:",e),alert("Unable to access microphone. Please check your permissions.")}},F=async()=>{if(D.current)try{let e=(await c()(D.current,{scale:2,backgroundColor:null,logging:!1})).toDataURL("image/png"),t=document.createElement("a");t.download="my-story.png",t.href=e,t.click()}catch(e){console.error("Error generating image:",e),alert("Failed to generate image. Please try again.")}},R=async()=>{if(D.current)try{let e=await c()(D.current,{scale:2,backgroundColor:null,logging:!1}),t=e.toDataURL("image/png"),a=new u.kH({orientation:"portrait",unit:"px",format:[e.width,e.height]});a.addImage(t,"PNG",0,0,e.width,e.height),a.save("my-story.pdf")}catch(e){console.error("Error generating PDF:",e),alert("Failed to generate PDF. Please try again.")}};return(0,n.jsxs)("div",{className:"container",children:[y&&(0,n.jsx)(s.Z,{width:v.width,height:v.height,recycle:!1,numberOfPieces:200,colors:["#FFB5C2","#A7C7E7","#C1E1C1","#FFE5B4","#E0BBE4"]}),(0,n.jsxs)(i.E.main,{className:"main",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,n.jsx)(i.E.h1,{className:"title",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},children:"Journal Entry"}),(0,n.jsxs)(i.E.form,{onSubmit:S,className:"form",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:[(0,n.jsxs)(i.E.div,{className:"entryContainer",whileHover:{scale:1.02},transition:{type:"spring",stiffness:300},children:[(0,n.jsx)("label",{htmlFor:"journal-entry",children:"Enter your journal entries (one per line):"}),(0,n.jsx)("textarea",{id:"journal-entry",value:e,onChange:e=>t(e.target.value),placeholder:"Enter your journal entries here, one per line...",required:!0,className:"textarea"})]}),(0,n.jsx)(i.E.button,{type:"submit",disabled:d,className:"submitButton",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:d?"Generating Story...":"Generate Story"})]}),(0,n.jsx)(o.M,{children:a&&(0,n.jsxs)(i.E.div,{className:"storyContainer",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},children:[(0,n.jsx)(i.E.h2,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.3},children:"Your Story"}),(0,n.jsxs)(i.E.div,{className:"bookFrame",initial:{rotateY:90},animate:{rotateY:0},transition:{delay:.4,duration:.8,type:"spring"},ref:D,children:[(0,n.jsx)("div",{className:"bookSpine"}),(0,n.jsx)("div",{className:"bookCorner bookCornerTopLeft"}),(0,n.jsx)("div",{className:"bookCorner bookCornerTopRight"}),(0,n.jsx)("div",{className:"bookCorner bookCornerBottomLeft"}),(0,n.jsx)("div",{className:"bookCorner bookCornerBottomRight"}),(0,n.jsx)(i.E.div,{className:"bookPages",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.5},children:(0,n.jsx)("div",{className:"story",children:a})})]}),(0,n.jsxs)("div",{className:"audioControls",children:[(0,n.jsx)(i.E.button,{onClick:p?()=>{k.current&&(window.speechSynthesis.cancel(),w(!1))}:()=>{if(!a)return;k.current&&k.current.cancel();let e=new SpeechSynthesisUtterance(a);e.rate=.9,e.pitch=1.1,e.volume=1;let t=window.speechSynthesis.getVoices().find(e=>e.name.includes("Google")||e.name.includes("Samantha")||e.name.includes("Microsoft"));t&&(e.voice=t),e.onstart=()=>w(!0),e.onend=()=>w(!1),e.onerror=()=>w(!1),k.current=e,window.speechSynthesis.speak(e)},className:"audioButton",whileHover:{scale:1.05},whileTap:{scale:.95},children:p?"⏹️ Stop AI Narration":"\uD83D\uDD0A Play AI Narration"}),(0,n.jsx)(i.E.button,{onClick:g?()=>{x.current&&g&&(x.current.stop(),x.current.stream.getTracks().forEach(e=>e.stop()))}:P,className:"audioButton",whileHover:{scale:1.05},whileTap:{scale:.95},children:g?"⏹️ Stop Recording":"\uD83C\uDFA4 Record Parent Voice"}),E&&(0,n.jsx)(i.E.button,{onClick:()=>{b.current&&b.current.play()},className:"audioButton",whileHover:{scale:1.05},whileTap:{scale:.95},children:"\uD83D\uDD0A Play Parent Recording"})]}),(0,n.jsxs)("div",{className:"downloadControls",children:[(0,n.jsx)(i.E.button,{onClick:F,className:"downloadButton",whileHover:{scale:1.05},whileTap:{scale:.95},children:"\uD83D\uDCF8 Download as Image"}),(0,n.jsx)(i.E.button,{onClick:R,className:"downloadButton",whileHover:{scale:1.05},whileTap:{scale:.95},children:"\uD83D\uDCC4 Download as PDF"})]}),(0,n.jsx)("audio",{ref:b,className:"hidden"})]})})]})]})}}},function(e){e.O(0,[847,443,368,888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);